---
layout: post
title: "The Beetle Bot"
excerpt: "All about a twitter bot that dispenses facts about beetles."
tags: [twitter]
comments: true
image:
  feature: beetle-bot.jpg
  credit: Wikimedia Commons
  creditlink: https://commons.wikimedia.org/wiki/File:Carabus_insulicola.jpg
---

# I am the beetleBot
This is the github page of the twitter bot @beetleOfTheDay. This bot will tweet photos and known life history facts about beetles. Tweets are randomly generated by the code in the repository [klevan/beetleBot](klevan/beetleBot).

## Ecology & Big Data: Continuing gaps
Ecology is now moving into the realm of large, query-able databases; databases that document georeferenced species occurrences (see [GBIF](http://gbif.org)), databases that tell you pathogen history such as [Vector Map](http://vectormap.org), and databases that clarify confusing taxonomy like [ITIS](http://itis.gov). But there is a crucial (and obvious) piece missing from all these lists of "Species A was at Location B at Time C". However, I don't know of any database that really collates interaction and life history data about any of these species. This leaves us in the uncomfortable situation where we can observe that "the range of Bird A is moving North" or "Insect B is only observed in location X anymore", but not understand the specific mechanism underlying these changes because known information about these species (i.e., 80% of Bird A's diet is Insect B) is locked into the literature in disparate articles and no database can massage this information into a comprehensive format. It's a very real and frustrating problem that we *have the information* to known the causes of change, but there's no way currently to extract that information programmatically. 

## Why this project won't solve anything, but will be entertaining
I decided to make a twitter bot that could tell me factoids about insect life history on a regular basis. I found a paper (Larochelle, A. and M.C. Lariviere. 2001. Natural history of the tiger beetles of North America north of Mexico. Cicindela 33(3-4): 41-162) that documents the life history traits of North American Tiger beetles. With this information, I was able to parse the text to extract standardized information about each of the species. From there I built a twitter bot that would sample the database for a random species, choose a fact related to that species at random and construct a tweet from a set of predefined adjectives/nouns/transitional phrases. The result is a sort of madlibs that combines a fact about a species of Tiger beetle with a photo.

![alt text](//klevan.github.io/images/rfigs/beetleBot1.png "beetleBot output")


This turns out to be pretty simple to implement using the *twitteR* package. Others have great examples demonstrating uses of *twitteR* to make bots. See [here](https://rstudio-pubs-static.s3.amazonaws.com/54352_3afcd597884a4192b3361513f2d32699.html) and [here](http://www.r-datacollection.com/blog/How-to-conduct-a-tombola-with-R/), for instance. 

### Using a twitter client
I needed to install a few libraries to get this to work. 
Namely:

* `library("httr")`
* `library("twitteR")`
* `library("ROAuth")`

Once you have those installed, you need to get authentication for your R session. You can do this by going to https://apps.twitter.com/ and signing in with your usual login and password. You will need your Consumer Key (API Key), Consumer Secret (API Secret), an Access Token, and Access Token Secret.

    api_key <- "Your Consumer Key"
    api_secret <- "Your API Secret Key"
    access_token <- "Your Access Token"
    access_token_secret <- "Your Access Token Secret"

 `setup_twitter_oauth(api_key,api_secret,access_token,access_token_secret)`

### Import the data
All the life history data comes from [Larochelle and Lariviere 2001](data/Larochelle&Lariviere2001.pdf). I have converted the [text from the pdf](data/Larochelle & Lariviere 2001.txt) into a csv file via a [cleanup script](code/data cleanup.R)

    # Import data
    life <- read.csv("~/GitHub/beetleBot/data/lifehist.csv", 
                      stringsAsFactors=FALSE)


    # Choose a beetle
    beetle_name <- sample(life$scientificName,1)
    if(nchar(life$beetle_photo[grepl(beetle_name,
                                      life$scientificName)])>0){
      beetle_photo <- paste("~/GitHub/beetleBot/images",
                            life$beetle_photo[grepl(beetle_name,
                                                    life$scientificName)],
                            sep="/")
    } else {
      beetle_photo <- ""
    }

We have chosen one species at random. In the database, we have several facts associated with this species. 
The easiest facts to parse from Larochelle and Lariviere 2001 are:

1. Methods of dispersal
2. Seasonality (time of year you can find that species)
3. Nocturnal/Diurnal/Crepuscular
4. Whether it is predatory
5. Rarity
6. Flying ability
7. Diet of the species
8. Predators of the species
9. The time of year that species is most vulnerable

#### Determine known facts

#### 1. Find dispersal information about the beetle

    dispersal <- strsplit(life$Dispersal[match(beetle_name,life$scientificName)],split="\\.")[[1]]
                          [sample(1:length(strsplit(life$Dispersal[match(beetle_name,
                                                                        life$scientificName)],split="\\. ")[[1]]),1)]

#### 2. Find seasonality information about the beetle

    seasonal <- substr(strsplit(life$Biology[match(beetle_name,life$scientificName)],split = "\\. ")
                      [[1]][1],14,nchar(strsplit(life$Biology[match(beetle_name,life$scientificName)],
                                        split = "\\. ")[[1]][1]))
                                        

#### 3. Is the species diurnal, nocturnal or crepuscular

`dayOrNight <- life$dayOrNight[match(beetle_name,life$scientificName)]`

#### 4. Is it predatory?

`predatory <- life$predatory[match(beetle_name,life$scientificName)]`

#### 5. Or rare?

    conservation_status <- strsplit(life$conservationStatus[match(beetle_name,life$scientificName)],
                                split="\\. ")[[1]][sample(1:length(strsplit(life$conservationStatus
                                [match(beetle_name,life$scientificName)],split="\\. ")[[1]]),1)]
                                

#### 6. Can this beetle fly?

    flightData <- data.frame(wings=c("Subapterous","Flightless","Subapterous; Flightless",
                                 "Macropterous","Macropterous, Although some Flightless 
                                 Specimens Were Seen that Had Fused Elytra (NY)",
                                 "Macropterous, Capable of Flight","Wing Condition Unknown",
                                 "Unknown."),status=c(rep(1,3),rep(2,3),rep(NA,2)),
                         stringsAsFactors = FALSE)
    can_fly <- flightData$status[match(life$wings[match(beetle_name,life$scientificName)],flightData$wings)]
    rm(flightData)
    if(can_fly==1){
    can_fly <- sample(c("is totally flightless","thinks flying is for chumps","cannot fly",
                      "is earthbound","has so much in common with penguins"),1)
    }
    if(can_fly==2){
    can_fly <- sample(c("is a pretty great flier","will escape you on the wing",
                      "isn't afraid to fly","has large wings","has enormous wings"),1)
    }

#### 7. What eats this species?

    prey_of <- strsplit(life$predators[match(beetle_name,life$scientificName)],
                    split=",")[[1]][sample(1:length(strsplit(life$predators
                    [match(beetle_name,life$scientificName)],split=", ")[[1]]),1)]
                    

#### 8. What does this species prey upon?

    preys_on <- strsplit(life$prey[match(beetle_name,life$scientificName)],
                     split=",")[[1]][sample(1:length(strsplit(life$prey
                    [match(beetle_name,life$scientificName)],split=", ")[[1]]),1)]
                    

#### 9. Teneral time frame for this beetle (if known)

    most_vulnerable <- strsplit(strsplit(life$Biology[match(beetle_name,
                   life$scientificName)],split="Tenerals: ")[[1]][2],split = "\\. ")[[1]][1]

Then we will chose one at random, but we won't pick categories of facts where information is unavailable. 

    # Choose one of the facts
    # Don't pick categories where info is unknown or non-existent
    facts <- c(can_fly,conservation_status,dayOrNight,dispersal,predatory,
           preys_on,prey_of,most_vulnerable,seasonal)
    random_fact <- sample(facts[is.na(facts)==FALSE & tolower(facts)!="unknown"],1)
    rm(facts)

## Making a fact into a tweet
### Phrasing is important

To make the tweet more interesting, I have a script that generates wording to surround the beetle fact. First, the script chooses among a list of pre-defined introductory phrases.

    # An intro phrase
    intro_phrase <- c("Wow! Did you know that","Didn't know that",
                      "Just learned that","Found out that",
                      "Amazing!")
    intro_phrase <- sample(intro_phrase,1)

Then, depending on which fact was selected, an appropriate transitional phrase is used.

    # A transitional phrase
    # Which transition phrase to use?
    if(random_fact%in%conservation_status|random_fact%in%dispersal){
    transitional_phrase <- "is a"  
    random_fact <- paste(c(transitional_phrase,tolower(random_fact)),collapse = " ")
    }
    if(random_fact%in%seasonal){
      transitional_phrase <- "is most commonly found"  
      random_fact <- paste(c(transitional_phrase,random_fact),collapse = " ")
    }
    if(random_fact%in%most_vulnerable){
      transitional_phrase <- "is most vulnerable (teneral phase) in"  
      random_fact <- paste(c(transitional_phrase,random_fact),collapse = " ")
    }
    if(random_fact%in%dayOrNight|random_fact%in%predatory){
      transitional_phrase <- "is"  
      random_fact <- paste(c(transitional_phrase,tolower(random_fact)),collapse = " ")
    }
    if(random_fact%in%preys_on){
      transitional_phrase <- c("chows down on","eats","noshes on","lunches on",
                              "dines on","loves eating","devours","ingest","consume",
                           "polish off","feast upon","attack","wolfs down",
                           "snack on","gorge on","graze","munch on","nibble on")
    transitional_phrase <- sample(transitional_phrase,1)  
    random_fact <- paste(c(transitional_phrase,tolower(random_fact)),collapse = " ")
    }
    if(random_fact%in%prey_of){
    transitional_phrase <- c("fear","are prey of","run away from","couldn't be caught dead near",
                           "are hunted by","are the favorite food of","are the favorite meal of",
                           "frequently become lunch for","are badgered by","are dogged by",
                           "are stalked by","are chased by", "are occasionally ambushed by",
                           "never approach","have a lot of anxiety about","have one nightmare:",
                           "have an aversion to","have trepidation around",
                           "get panicked around","get the jitters around")
    transitional_phrase <- sample(transitional_phrase,1)  
    random_fact <- paste(c(transitional_phrase,tolower(random_fact)),collapse = " ")
    }

These elements are pasted together to create a realistic sentence. If there is space, I will also include a complement after the factoid. These are created by choosing from and pasting together a transitional phrase, one or more adjectives, and a noun.

    # Adjectives and nouns for a secondary sentence
    transitional_phrase2 <- c("What a","How great is this","Can't wait to learn more about this",
                          "That's some kind of","There's always some new")
    transitional_phrase2 <- sample(transitional_phrase2,1) 
    adjectives <- c("majestic","one-of-a-kind","wonderful","beautiful",
                 "cool","fascinating","gorgeous")
    numb_adjectives <- sample(seq(0,2,1),size=1)
    random_adjectives <- sample(adjectives,size=numb_adjectives)


    # Choose a noun
    nouns <- c("insect","invert","invertebrate","species","organism")
    random_noun <- sample(nouns,size=1); rm(nouns)

Lastly, that is appended to a hashtag, chosen at random.

    # randomly choose a hashtag
    hashtags <- c("#coleoptera","#beetles","#insects","#beautifulBeetles","#meetTheBeetles")
    random_hashtag <- sample(hashtags,size=1); rm(hashtags)

### Combine the phrases and facts to make a coherent tweet
The ideal final tweet will have a:

1. fact about a species
2. complementary phrase
3. photo credit mention

#### My final species fact

    species_fact <- paste(c(intro_phrase, beetle_name, random_fact),collapse = " ")
    if(strsplit(species_fact,"?")[[1]][nchar(species_fact)]!="."){
      species_fact <- paste0(species_fact,".")
    }

#### The finalized complementary phrase
This mostly gets used when there isn't a photo available, for reasons of character length.

    complement <- paste(c(transitional_phrase2,random_adjectives,paste0(random_noun,"!"),
                      random_hashtag),collapse = " ")

#### Is there a photo? Do I have an attribution for it yet?

    if(beetle_photo!="" & life$mentions[grepl(beetle_name,life$scientificName)]!=""){
      species_fact <- paste(c(species_fact,life$mentions
                          [beetle_name,life$scientificName]),collapse = " ")
    }


#### Taking into account character length
The tweet has to be 140 characters or less; if I have a photo for it, then it can't exceed 117 characters.

    if (beetle_photo==""){
      maxTweetLength <- 140
    } else {
      maxTweetLength <- 117
    }
    if ((nchar(species_fact)+nchar(complement))<maxTweetLength){
      tweettxt <- paste(c(species_fact,complement),collapse = " ")
    }
    if ((nchar(species_fact)+nchar(complement))>maxTweetLength){
      if (nchar(species_fact)<maxTweetLength){
        tweettxt <- species_fact
      }
    }

## Tweet the text!

    if(nchar(tweettxt)<maxTweetLength){
      if(nchar(beetle_photo)>0){
        tweet(tweettxt,mediaPath=beetle_photo)
      }
    if(nchar(beetle_photo)==0){
      tweet(tweettxt)
      }
    }
    rm(tweettxt)


![alt text](//klevan.github.io/images/rfigs/beetleBot2.png "beetleBot output")

### Beetle photography sources
There are a number of talented entomologists/taxonomists/ecologists that have taken high quality photos of Tiger beetles. The photos used by the twitter bot are currently sourced from the following locations. Where possible, I cite the origin of the photos with the appropriate mention, hashtag or DOI. These tags are stored in the mentions column of the life history table.

Carabidae.org
:   This is a database/repository of photos of carabid (ground) beetles organized by taxonomy. However, only 23 of the 215 species described in the paper were photographed and present in the database.

*    Many photographs are taken by Henri Goulet and Alexander Anichtchenko

Denver Museum of Nature and Science
:   DMNS has some wonderfully high-res images of carabids taken in lateral- and dorsal-view. All the photos from DMNS have their image code stamped on the lower right hand corner of the photo. The format is DMNS_ZE.##### and can be used to look up the physical specimen in their archive.

Ted C. MacRae
:   A wonderful entomologist. I am a huge fan of his wordpress blog. He takes breathtaking photos of insects in their natural habitats and includes interesting life history in his descriptions of each animal. His website [beetlesinthebush.wordpress.com](beetlesinthebush.wordpress.com) is worth a read. 

Conservation status of United States tiger beetles
:   An article (Knisley et al. Terrestrial Arthropod Reviews 7 (2014) 93?145) that includes a rather nice discussion of some of the rare species and subspecies of U.S. Tiger beetles. Has some stellar photos.

Tiger beetles (Cicindelidae) of the Northwest Territories: Distribution, status and other information
:   A report written by PM Catling in 2006, an excellent Canadian carabidologist. I especially appreciate his key to the Cicindelidae, which he includes in the the report. Given how disparate the information is (seriously, don't get me started on the frustrations of *finding* appropriate taxonomic keys), I'm always grateful when someone takes the effort to actually include a key for a larger group of species in lieu of publishing "descriptions" of what makes the new thing they found different. Includes photos of a few species.
